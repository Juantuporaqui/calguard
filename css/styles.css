/* ═══════════════════════════════════════════════════
   CalGuard - Policía Científica CNP
   Cuadrante + Bitácora Operativa
   Mobile-first, dark mode, accessible, print-ready
   ═══════════════════════════════════════════════════ */

/* ─── CSS Custom Properties ─── */
:root {
  /* Colors - Light mode */
  --bg-primary: #f0f2f5;
  --bg-secondary: #ffffff;
  --bg-tertiary: #e8ecf0;
  --bg-nav: #1a2332;
  --text-primary: #1a1a2e;
  --text-secondary: #4a5568;
  --text-muted: #8896a6;
  --border-color: #d1d9e0;
  --accent: #2563eb;
  --accent-hover: #1d4ed8;
  --accent-light: #dbeafe;

  /* Semantic colors - Event types */
  --guardia: #dc2626;
  --guardia-bg: #FEE2E2;
  --guardia-border: #F87171;
  --guardia-plan: #f97316;
  --guardia-plan-bg: #FFEDD5;
  --guardia-plan-border: #FB923C;
  --libre: #16a34a;
  --libre-bg: #D1FAE5;
  --libre-border: #34D399;
  --vacaciones: #0891b2;
  --vacaciones-bg: #DBEAFE;
  --vacaciones-border: #60A5FA;
  --ap: #7c3aed;
  --ap-bg: #EDE9FE;
  --ap-border: #A78BFA;
  --formacion: #059669;
  --formacion-bg: #D1FAE5;
  --formacion-border: #34D399;
  --juicio: #be185d;
  --juicio-bg: #FCE7F3;
  --juicio-border: #F472B6;
  --turno-m: #ca8a04;
  --turno-m-bg: #FEF9C3;
  --turno-m-border: #FACC15;
  --turno-t: #ea580c;
  --turno-t-bg: #FFEDD5;
  --turno-t-border: #FB923C;
  --weekend-bg: #f8fafc;
  --today-ring: #2563eb;
  --selected-bg: #dbeafe;
  --danger: #dc2626;
  --success: #16a34a;
  --warn: #d97706;

  /* Spacing */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;

  /* Typography */
  --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  --font-mono: ui-monospace, 'SF Mono', monospace;
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;

  /* Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
  --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
}

/* ─── Dark Mode ─── */
html.dark {
  --bg-primary: #0d1520;
  --bg-secondary: #1a2332;
  --bg-tertiary: #243447;
  --bg-nav: #0d1520;
  --text-primary: #e2e8f0;
  --text-secondary: #a0aec0;
  --text-muted: #718096;
  --border-color: #2d3748;
  --accent: #3b82f6;
  --accent-hover: #60a5fa;
  --accent-light: #1e3a5f;
  --weekend-bg: #162030;
  --selected-bg: #1e3a5f;
  --guardia-bg: rgba(220, 38, 38, 0.25);
  --guardia-border: #F87171;
  --guardia-plan-bg: rgba(249, 115, 22, 0.2);
  --guardia-plan-border: #FB923C;
  --libre-bg: rgba(22, 163, 74, 0.2);
  --libre-border: #34D399;
  --vacaciones-bg: rgba(8, 145, 178, 0.2);
  --vacaciones-border: #60A5FA;
  --ap-bg: rgba(124, 58, 237, 0.2);
  --ap-border: #A78BFA;
  --formacion-bg: rgba(5, 150, 105, 0.15);
  --formacion-border: #34D399;
  --juicio-bg: rgba(190, 24, 93, 0.15);
  --juicio-border: #F472B6;
  --turno-m-bg: rgba(202, 138, 4, 0.2);
  --turno-m-border: #FACC15;
  --turno-t-bg: rgba(234, 88, 12, 0.2);
  --turno-t-border: #FB923C;
}

/* ─── Reset ─── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 16px; -webkit-text-size-adjust: 100%; }
body {
  font-family: var(--font);
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.5;
  min-height: 100vh;
  min-height: 100dvh;
  -webkit-font-smoothing: antialiased;
}
button { cursor: pointer; font-family: inherit; }
input, select, textarea { font-family: inherit; font-size: var(--text-base); }

/* ─── Focus visible ─── */
:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* ─── App container ─── */
#app {
  max-width: 1200px;
  margin: 0 auto;
  padding-bottom: 72px; /* nav height */
}

/* ─── Loading ─── */
.loading-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  gap: var(--space-md);
  color: var(--text-secondary);
}

.spinner {
  width: 40px; height: 40px;
  border: 3px solid var(--border-color);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

/* ─── Navigation Bar ─── */
.nav-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  background: var(--bg-nav);
  border-top: 1px solid rgba(255,255,255,0.1);
  z-index: 100;
  padding: env(safe-area-inset-bottom, 0);
}

.nav-tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 4px 10px;
  background: none;
  border: none;
  color: rgba(255,255,255,0.5);
  font-size: var(--text-xs);
  transition: color 0.2s;
}

.nav-tab.active { color: #fff; }
.nav-tab:hover { color: rgba(255,255,255,0.8); }
.nav-icon { font-size: 1.25rem; line-height: 1; }
.nav-label { font-size: var(--text-xs); white-space: nowrap; }

/* ─── Update Banner ─── */
.update-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--accent);
  color: #fff;
  padding: var(--space-sm) var(--space-md);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  font-size: var(--text-sm);
  z-index: 200;
}

.update-banner button {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.4);
  color: #fff;
  padding: 4px 12px;
  border-radius: var(--radius-sm);
  font-size: var(--text-sm);
}

/* ─── Buttons ─── */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xs);
  padding: 10px 20px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: var(--text-sm);
  font-weight: 500;
  transition: all 0.15s;
  white-space: nowrap;
}

.btn:hover { background: var(--bg-tertiary); }
.btn-primary { background: var(--accent); color: #fff; border-color: var(--accent); }
.btn-primary:hover { background: var(--accent-hover); }
.btn-secondary { background: var(--bg-tertiary); }
.btn-danger { background: var(--danger); color: #fff; border-color: var(--danger); }
.btn-success { background: var(--success); color: #fff; border-color: var(--success); }
.btn-sm { padding: 6px 12px; font-size: var(--text-xs); }
.btn-icon { padding: 8px 12px; font-size: var(--text-lg); border: none; background: none; color: var(--text-primary); }
.btn-icon:hover { background: var(--bg-tertiary); border-radius: var(--radius-md); }

/* ─── Cards ─── */
.card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
}

/* ═══════════════════════════════════════════════════
   DASHBOARD
   ═══════════════════════════════════════════════════ */
.dashboard { padding: var(--space-md); }

.dashboard-header {
  text-align: center;
  padding: var(--space-lg) var(--space-md);
}

.dashboard-header h1 {
  font-size: var(--text-2xl);
  font-weight: 700;
  letter-spacing: -0.025em;
}

.subtitle {
  color: var(--text-secondary);
  font-size: var(--text-sm);
  margin-top: 2px;
}

.today-date {
  color: var(--accent);
  font-weight: 600;
  margin-top: var(--space-xs);
}

/* Today status */
.today-status {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.today-status h3 { font-size: var(--text-sm); color: var(--text-secondary); margin-bottom: var(--space-xs); }

.tag-list { display: flex; flex-wrap: wrap; gap: var(--space-xs); }

.tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
  font-weight: 600;
}

.tag-guardia_real { background: var(--guardia-bg); color: var(--guardia); }
.tag-guardia_plan { background: var(--guardia-plan-bg); color: var(--guardia-plan); }
.tag-libre { background: var(--libre-bg); color: var(--libre); }
.tag-vacaciones { background: var(--vacaciones-bg); color: var(--vacaciones); }
.tag-ap { background: var(--ap-bg); color: var(--ap); }
.tag-turno_m { background: var(--turno-m-bg); color: var(--turno-m); }
.tag-turno_t { background: var(--turno-t-bg); color: var(--turno-t); }
.tag-turno_n { background: var(--bg-tertiary); color: var(--text-primary); }
.tag-formacion { background: var(--formacion-bg); color: var(--formacion); }
.tag-juicio { background: var(--juicio-bg); color: var(--juicio); }
.tag-otro { background: var(--bg-tertiary); color: var(--text-secondary); }

/* Alerts */
.alerts-section { margin-bottom: var(--space-md); }

.alert {
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  margin-bottom: var(--space-xs);
}

.alert-warn { background: rgba(217, 119, 6, 0.1); color: var(--warn); border-left: 3px solid var(--warn); }
.alert-info { background: var(--accent-light); color: var(--accent); border-left: 3px solid var(--accent); }

/* Counters grid */
.counters-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.counters-grid.compact { grid-template-columns: repeat(4, 1fr); }

.counter-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: var(--space-sm) var(--space-xs);
  text-align: center;
}

.counter-value {
  display: block;
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--accent);
}

.counter-label {
  display: block;
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-top: 2px;
}

/* Week overview */
.week-overview {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.week-overview h3 { font-size: var(--text-sm); color: var(--text-secondary); margin-bottom: var(--space-sm); }

.week-row {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: var(--space-xs);
}

.week-day {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-xs);
  border-radius: var(--radius-sm);
  min-height: 56px;
  font-size: var(--text-xs);
}

.week-day.today { box-shadow: inset 0 0 0 2px var(--today-ring); border-radius: var(--radius-md); }
.week-day.weekend { background: var(--weekend-bg); }
.week-day.has-guardia { background: var(--guardia-bg); }
.week-day.has-plan { background: var(--guardia-plan-bg); }
.week-day.has-vacaciones { background: var(--vacaciones-bg); }
.week-day.has-libre { background: var(--libre-bg); }
.week-day.has-ap { background: var(--ap-bg); }
.week-day-name { font-weight: 600; color: var(--text-muted); }
.week-day-num { font-weight: 700; font-size: var(--text-sm); }
.week-tag { font-size: 0.65rem; font-weight: 700; margin-top: 1px; }

/* Next guard card */
.next-guard-card {
  background: var(--guardia-plan-bg);
  border: 1px solid rgba(249, 115, 22, 0.2);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.next-guard-card h3 { font-size: var(--text-sm); color: var(--guardia-plan); }
.next-guard-card p { font-weight: 600; }

/* Guard summary */
.guard-summary {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.guard-summary h3 { font-size: var(--text-sm); color: var(--text-secondary); margin-bottom: var(--space-sm); }

.guard-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) 0;
  font-size: var(--text-sm);
}

.guard-balance { color: var(--text-muted); font-size: var(--text-xs); }

.guard-progress {
  flex: 1;
  height: 6px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.guard-progress-bar {
  height: 100%;
  background: var(--accent);
  border-radius: var(--radius-full);
  transition: width 0.3s;
}

/* Quick actions */
.quick-actions {
  display: flex;
  gap: var(--space-sm);
  margin-top: var(--space-md);
}

.quick-actions .btn { flex: 1; }

/* ═══════════════════════════════════════════════════
   CALENDAR
   ═══════════════════════════════════════════════════ */
.calendar-view { padding: var(--space-md); }

.calendar-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-sm);
}

.calendar-title-group {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.calendar-title {
  font-size: var(--text-lg);
  font-weight: 700;
  min-width: 160px;
  text-align: center;
}

.calendar-actions {
  display: flex;
  gap: var(--space-xs);
  margin-bottom: var(--space-md);
  justify-content: center;
}

/* Calendar grid */
.calendar-grid-container { margin-bottom: var(--space-md); }

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: var(--border-color);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.weekday {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-nav);
  color: rgba(255,255,255,0.7);
  font-weight: 600;
  font-size: var(--text-xs);
  padding: var(--space-xs);
  height: 32px;
}

.weekday.compact { height: 24px; font-size: 0.65rem; }

.day {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: var(--bg-secondary);
  min-height: 52px;
  cursor: pointer;
  transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
  user-select: none;
}

.day:hover { background: var(--accent-light); transform: scale(1.05); box-shadow: var(--shadow-sm); z-index: 1; }
.day.empty { cursor: default; background: var(--bg-tertiary); }
.day.empty:hover { background: var(--bg-tertiary); }
.day.compact { min-height: 32px; }
.day.weekend { background: var(--weekend-bg); }
.day.today { box-shadow: inset 0 0 0 2px var(--today-ring); z-index: 1; }

/* Day types - solid bg + left border accent */
.day.guardia { background: var(--guardia-bg); border-left: 5px solid var(--guardia-border); }
.day.guardia .day-num { color: var(--guardia); font-weight: 800; }
.day.proxima-guardia { background: var(--guardia-plan-bg); border-left: 5px solid var(--guardia-plan-border); border-right: 1px dashed var(--guardia-plan); }
.day.proxima-guardia .day-num { color: var(--guardia-plan); }
.day.libre { background: var(--libre-bg); border-left: 5px solid var(--libre-border); }
.day.libre .day-num { color: var(--libre); }
.day.vacaciones { background: var(--vacaciones-bg); border-left: 5px solid var(--vacaciones-border); }
.day.vacaciones .day-num { color: var(--vacaciones); }
.day.asunto { background: var(--ap-bg); border-left: 5px solid var(--ap-border); }
.day.asunto .day-num { color: var(--ap); }
.day.formacion { background: var(--formacion-bg); border-left: 5px solid var(--formacion-border); }
.day.formacion .day-num { color: var(--formacion); }
.day.juicio { background: var(--juicio-bg); border-left: 5px solid var(--juicio-border); }
.day.juicio .day-num { color: var(--juicio); }

/* Shift-only day types */
.day.turno-m { background: var(--turno-m-bg); border-left: 5px solid var(--turno-m-border); }
.day.turno-m .day-num { color: var(--turno-m); }
.day.turno-t { background: var(--turno-t-bg); border-left: 5px solid var(--turno-t-border); }
.day.turno-t .day-num { color: var(--turno-t); }

/* ─── Diagonal Divisions for mixed shifts ─── */
/* When a day has both a main type + shift, show diagonal split */
.day.guardia.turno-m {
  background: linear-gradient(135deg, var(--guardia-bg) 50%, var(--turno-m-bg) 50%);
  border-left: 5px solid var(--guardia-border);
}
.day.guardia.turno-t {
  background: linear-gradient(135deg, var(--guardia-bg) 50%, var(--turno-t-bg) 50%);
  border-left: 5px solid var(--guardia-border);
}
.day.libre.turno-m {
  background: linear-gradient(135deg, var(--libre-bg) 50%, var(--turno-m-bg) 50%);
  border-left: 5px solid var(--libre-border);
}
.day.libre.turno-t {
  background: linear-gradient(135deg, var(--libre-bg) 50%, var(--turno-t-bg) 50%);
  border-left: 5px solid var(--libre-border);
}
.day.vacaciones.turno-m {
  background: linear-gradient(135deg, var(--vacaciones-bg) 50%, var(--turno-m-bg) 50%);
  border-left: 5px solid var(--vacaciones-border);
}
.day.vacaciones.turno-t {
  background: linear-gradient(135deg, var(--vacaciones-bg) 50%, var(--turno-t-bg) 50%);
  border-left: 5px solid var(--vacaciones-border);
}
.day.asunto.turno-m {
  background: linear-gradient(135deg, var(--ap-bg) 50%, var(--turno-m-bg) 50%);
  border-left: 5px solid var(--ap-border);
}
.day.asunto.turno-t {
  background: linear-gradient(135deg, var(--ap-bg) 50%, var(--turno-t-bg) 50%);
  border-left: 5px solid var(--ap-border);
}
.day.formacion.turno-m {
  background: linear-gradient(135deg, var(--formacion-bg) 50%, var(--turno-m-bg) 50%);
  border-left: 5px solid var(--formacion-border);
}
.day.formacion.turno-t {
  background: linear-gradient(135deg, var(--formacion-bg) 50%, var(--turno-t-bg) 50%);
  border-left: 5px solid var(--formacion-border);
}

.day-num { font-weight: 600; font-size: var(--text-sm); line-height: 1; }
.day.compact .day-num { font-size: var(--text-xs); }

/* Day labels */
.day-label {
  position: absolute;
  font-size: 0.6rem;
  font-weight: 700;
  line-height: 1;
}

.label-m { top: 2px; left: 3px; color: var(--accent); }
.label-t { top: 2px; right: 3px; color: var(--guardia-plan); }
.label-n { bottom: 2px; left: 3px; color: var(--text-muted); }
.label-otro { bottom: 2px; right: 2px; color: var(--text-muted); font-size: 0.55rem; max-width: 100%; overflow: hidden; text-overflow: ellipsis; }

/* Multi-select */
.day.multi-selected {
  box-shadow: inset 0 0 0 2px var(--success);
  background: var(--libre-bg);
}

/* Month blocks (full year view) */
.year-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: var(--space-md);
}

.month-block { margin-bottom: var(--space-md); }
.month-compact .month-name {
  text-align: center;
  font-weight: 700;
  font-size: var(--text-sm);
  padding: var(--space-xs);
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}

/* Range/multi-select mode banners */
.range-banner,
.multi-select-mode .range-banner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  padding: var(--space-sm) var(--space-md);
  background: var(--accent-light);
  color: var(--accent);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-md);
  font-weight: 600;
  font-size: var(--text-sm);
}

/* ═══════════════════════════════════════════════════
   CONTEXT MENU
   ═══════════════════════════════════════════════════ */
.ctx-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  z-index: 500;
}

.ctx-menu {
  position: fixed;
  z-index: 510;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  padding: var(--space-sm);
  width: 260px;
  max-height: 80vh;
  overflow-y: auto;
}

.ctx-header {
  font-weight: 700;
  font-size: var(--text-sm);
  color: var(--text-secondary);
  padding: var(--space-xs) var(--space-sm);
  border-bottom: 1px solid var(--border-color);
  margin-bottom: var(--space-xs);
}

.ctx-section {
  margin-bottom: var(--space-xs);
}

.ctx-section-title {
  font-size: var(--text-xs);
  color: var(--text-muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: var(--space-xs) var(--space-sm);
}

.ctx-btn {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  width: 100%;
  padding: 8px var(--space-sm);
  border: none;
  background: none;
  color: var(--text-primary);
  font-size: var(--text-sm);
  border-radius: var(--radius-sm);
  transition: background 0.1s;
  text-align: left;
}

.ctx-btn:hover { background: var(--bg-tertiary); }

.ctx-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: 700;
  color: #fff;
}

.guardia-icon { background: var(--guardia); }
.plan-icon { background: var(--guardia-plan); }
.libre-icon { background: var(--libre); }
.ap-icon { background: var(--ap); }
.vac-icon { background: var(--vacaciones); }
.turno-icon { background: var(--text-muted); }
.form-icon { background: var(--formacion); }
.juicio-icon { background: var(--juicio); }
.otros-icon { background: var(--text-secondary); }

.ctx-danger-section { border-top: 1px solid var(--border-color); padding-top: var(--space-xs); }
.ctx-danger { color: var(--danger); }
.ctx-danger:hover { background: rgba(220, 38, 38, 0.08); }

/* ═══════════════════════════════════════════════════
   MODALS
   ═══════════════════════════════════════════════════ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 600;
  padding: var(--space-md);
}

.modal-card {
  background: var(--bg-secondary);
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  width: 100%;
  max-width: 420px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
}

.modal-large { max-width: 540px; }

.modal-card h3 {
  font-size: var(--text-lg);
  margin-bottom: var(--space-md);
}

.modal-actions {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
  margin-top: var(--space-md);
}

.form-grid {
  display: grid;
  gap: var(--space-sm);
}

.form-grid label, .modal-card > label {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.form-grid input, .form-grid select,
.modal-card input, .modal-card select, .modal-card textarea {
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--text-sm);
}

.form-grid input:focus, .modal-card input:focus,
.form-grid select:focus, .modal-card select:focus,
.modal-card textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-warning {
  background: rgba(217, 119, 6, 0.1);
  color: var(--warn);
  padding: var(--space-sm);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  margin-bottom: var(--space-md);
  border-left: 3px solid var(--warn);
}

.form-section { margin: var(--space-sm) 0; }
.form-section > label:first-child { font-weight: 600; font-size: var(--text-sm); color: var(--text-secondary); }

.tag-selector {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
  margin-top: var(--space-xs);
}

.tag-checkbox {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  background: var(--bg-tertiary);
  padding: 4px 8px;
  border-radius: var(--radius-full);
  cursor: pointer;
}

.sensitivity-toggle {
  display: flex;
  flex-direction: row !important;
  align-items: center;
  gap: var(--space-sm);
  font-size: var(--text-sm);
  margin-top: var(--space-sm);
  color: var(--warn);
}

/* ═══════════════════════════════════════════════════
   SHARE POPUP
   ═══════════════════════════════════════════════════ */
.share-popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 700;
  padding: var(--space-md);
}

.share-popup-content {
  background: var(--bg-secondary);
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  width: 100%;
  max-width: 400px;
}

.share-popup-content h3 { margin-bottom: var(--space-sm); }

.share-popup-content textarea {
  width: 100%;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  padding: var(--space-sm);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  background: var(--bg-primary);
  color: var(--text-primary);
  resize: vertical;
}

.share-actions {
  display: flex;
  gap: var(--space-sm);
  margin-top: var(--space-md);
}

/* ═══════════════════════════════════════════════════
   REGISTRY (Bitácora)
   ═══════════════════════════════════════════════════ */
.registry-view { padding: var(--space-md); }

.registry-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-md);
}

.registry-header h2 { font-size: var(--text-lg); }

.registry-filters {
  display: flex;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.registry-filters select {
  flex: 1;
  padding: 6px 10px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: var(--text-sm);
}

.registry-summary {
  display: flex;
  gap: var(--space-md);
  color: var(--text-muted);
  font-size: var(--text-sm);
  margin-bottom: var(--space-md);
}

.service-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  margin-bottom: var(--space-sm);
}

.service-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-xs);
}

.service-type { font-weight: 700; font-size: var(--text-sm); }
.service-date { color: var(--text-muted); font-size: var(--text-xs); }

.service-details {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.service-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
  margin-top: var(--space-xs);
}

.service-tags .tag {
  background: var(--bg-tertiary);
  font-size: 0.65rem;
}

.service-notes {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-top: var(--space-xs);
  padding-top: var(--space-xs);
  border-top: 1px solid var(--border-color);
}

.sensitivity-badge {
  display: inline-block;
  padding: 1px 6px;
  background: rgba(217, 119, 6, 0.15);
  color: var(--warn);
  font-size: 0.6rem;
  font-weight: 700;
  border-radius: var(--radius-full);
  margin-top: var(--space-xs);
}

.service-delete { margin-top: var(--space-sm); }

.empty-state {
  text-align: center;
  color: var(--text-muted);
  padding: var(--space-xl);
  font-size: var(--text-sm);
}

/* ═══════════════════════════════════════════════════
   STATISTICS
   ═══════════════════════════════════════════════════ */
.stats-view { padding: var(--space-md); }
.stats-view h2 { font-size: var(--text-lg); margin-bottom: var(--space-md); }

.stats-period-selector {
  display: flex;
  gap: var(--space-xs);
  margin-bottom: var(--space-sm);
}

.stats-period-selector .btn.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
}

.stats-range {
  color: var(--text-muted);
  font-size: var(--text-sm);
  margin-bottom: var(--space-md);
  text-align: center;
}

.stats-summary-cards {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}

.stat-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: var(--space-sm);
  text-align: center;
}

.stat-value { display: block; font-size: var(--text-xl); font-weight: 700; color: var(--accent); }
.stat-label { display: block; font-size: var(--text-xs); color: var(--text-muted); }

.stats-section {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.stats-section h3 {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
}

/* Bar chart */
.bar-chart { display: flex; flex-direction: column; gap: var(--space-xs); }

.bar-row {
  display: grid;
  grid-template-columns: 100px 1fr 40px;
  gap: var(--space-sm);
  align-items: center;
  font-size: var(--text-xs);
}

.bar-label { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text-secondary); }
.bar-track { height: 16px; background: var(--bg-tertiary); border-radius: var(--radius-full); overflow: hidden; }
.bar-fill { height: 100%; background: var(--accent); border-radius: var(--radius-full); transition: width 0.4s; min-width: 4px; }
.bar-fill-alt { background: var(--formacion); }
.bar-value { text-align: right; font-weight: 600; }

/* Guard stats */
.guard-stats-list { display: flex; flex-direction: column; gap: var(--space-xs); }

.guard-stat-row {
  display: grid;
  grid-template-columns: 80px 1fr 40px;
  gap: var(--space-sm);
  align-items: center;
  font-size: var(--text-xs);
}

.guard-ref { font-weight: 600; }
.guard-progress-bar-container { height: 8px; background: var(--bg-tertiary); border-radius: var(--radius-full); overflow: hidden; }
.guard-fraction { text-align: right; color: var(--text-muted); }

/* ═══════════════════════════════════════════════════
   SETTINGS
   ═══════════════════════════════════════════════════ */
.settings-view { padding: var(--space-md); max-width: 600px; }
.settings-view h2 { font-size: var(--text-lg); margin-bottom: var(--space-lg); }

.settings-section {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.settings-section h3 {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  margin-bottom: var(--space-sm);
  font-weight: 600;
}

.settings-section .btn { margin-top: var(--space-sm); }

.checkbox-label {
  display: flex !important;
  flex-direction: row !important;
  align-items: center;
  gap: var(--space-sm);
  font-size: var(--text-sm);
  cursor: pointer;
}

.export-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
}

.file-upload-label {
  cursor: pointer;
}

.settings-danger {
  border-color: rgba(220, 38, 38, 0.3);
}

.settings-section textarea {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--text-sm);
  font-family: var(--font-mono);
  resize: vertical;
  margin-bottom: var(--space-xs);
}

/* ═══════════════════════════════════════════════════
   DIAGNOSTICS
   ═══════════════════════════════════════════════════ */
.diagnostics-view { padding: var(--space-md); max-width: 600px; }
.diagnostics-view h2 { font-size: var(--text-lg); margin-bottom: var(--space-md); }
.diagnostics-view > .btn { margin-right: var(--space-sm); margin-bottom: var(--space-md); }

.diag-results { margin-top: var(--space-md); }

.diag-item {
  display: flex;
  gap: var(--space-sm);
  padding: var(--space-sm);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-xs);
  font-size: var(--text-sm);
}

.diag-item strong { display: block; }
.diag-item p { font-size: var(--text-xs); color: var(--text-muted); margin: 0; }

.diag-pass { background: rgba(22, 163, 74, 0.08); }
.diag-fail { background: rgba(220, 38, 38, 0.08); }
.diag-icon { font-size: var(--text-lg); line-height: 1; }
.diag-pass .diag-icon { color: var(--success); }
.diag-fail .diag-icon { color: var(--danger); }

.diag-summary {
  padding: var(--space-md);
  border-radius: var(--radius-md);
  font-weight: 600;
  margin-bottom: var(--space-md);
  text-align: center;
}

.diag-summary.diag-pass { background: rgba(22, 163, 74, 0.1); color: var(--success); }
.diag-summary.diag-fail { background: rgba(220, 38, 38, 0.1); color: var(--danger); }

/* ═══════════════════════════════════════════════════
   LOCK SCREEN
   ═══════════════════════════════════════════════════ */
.lock-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  height: 100dvh;
  padding: var(--space-md);
}

.lock-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--space-xl);
  text-align: center;
  max-width: 320px;
  width: 100%;
  box-shadow: var(--shadow-lg);
}

.lock-icon { font-size: 3rem; margin-bottom: var(--space-md); }
.lock-card h2 { font-size: var(--text-lg); margin-bottom: var(--space-xs); }
.lock-card p { font-size: var(--text-sm); color: var(--text-muted); margin-bottom: var(--space-md); }

.pin-input-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.pin-input-group input {
  text-align: center;
  font-size: var(--text-xl);
  padding: 12px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  letter-spacing: 0.3em;
}

.pin-input-group input:focus {
  border-color: var(--accent);
  outline: none;
}

.error-text { color: var(--danger); font-size: var(--text-sm); margin-top: var(--space-xs); }

/* ═══════════════════════════════════════════════════
   TOAST
   ═══════════════════════════════════════════════════ */
#toast-container {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 800;
  pointer-events: none;
}

.toast {
  background: var(--bg-nav);
  color: #fff;
  padding: 10px 20px;
  border-radius: var(--radius-full);
  font-size: var(--text-sm);
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease;
  white-space: nowrap;
}

@keyframes toastIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ═══════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════ */
@media (max-width: 480px) {
  .counters-grid { grid-template-columns: repeat(2, 1fr); }
  .stats-summary-cards { grid-template-columns: repeat(2, 1fr); }
  .bar-row { grid-template-columns: 70px 1fr 30px; }
  .ctx-menu { width: calc(100vw - 20px); }
  .calendar-title { min-width: auto; font-size: var(--text-base); }
  .year-grid { grid-template-columns: 1fr; }
}

@media (min-width: 768px) {
  .nav-bar { max-width: 500px; left: 50%; transform: translateX(-50%); border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
  #app { padding: var(--space-md); padding-bottom: 80px; }
  .day { min-height: 64px; }
  .day.compact { min-height: 40px; }
}

@media (min-width: 1024px) {
  .counters-grid { grid-template-columns: repeat(6, 1fr); }
  .stats-summary-cards { grid-template-columns: repeat(4, 1fr); }
}

/* ═══════════════════════════════════════════════════
   PRINT STYLES
   ═══════════════════════════════════════════════════ */
@media print {
  .nav-bar,
  .update-banner,
  #toast-container,
  .ctx-overlay,
  .ctx-menu,
  .modal-overlay,
  .share-popup,
  .quick-actions,
  .btn,
  .registry-filters,
  .stats-period-selector,
  .service-delete {
    display: none !important;
  }

  body {
    background: #fff;
    color: #000;
    font-size: 10pt;
  }

  #app {
    padding: 0;
    max-width: none;
  }

  .calendar-grid { gap: 0; border: 1px solid #999; }
  .day { border: 1px solid #ccc; min-height: 28px; font-size: 8pt; }
  .weekday { background: #eee; color: #000; }
  .day.guardia { background: #ffe0e0 !important; border-left: 4px solid #f87171 !important; }
  .day.proxima-guardia { background: #fff0e0 !important; border-left: 4px solid #fb923c !important; }
  .day.libre { background: #e0ffe0 !important; border-left: 4px solid #34d399 !important; }
  .day.vacaciones { background: #e0f0ff !important; border-left: 4px solid #60a5fa !important; }
  .day.asunto { background: #f0e0ff !important; border-left: 4px solid #a78bfa !important; }
  .day.turno-m { background: #fef9c3 !important; border-left: 4px solid #facc15 !important; }
  .day.turno-t { background: #ffedd5 !important; border-left: 4px solid #fb923c !important; }
  .day.formacion { background: #d1fae5 !important; border-left: 4px solid #34d399 !important; }
  .day.juicio { background: #fce7f3 !important; border-left: 4px solid #f472b6 !important; }

  .counter-card { border: 1px solid #ccc; }
  .counter-value { color: #000; }

  .service-card { border: 1px solid #ccc; page-break-inside: avoid; }
  .stats-section { border: 1px solid #ccc; page-break-inside: avoid; }

  .bar-track { background: #eee; }
  .bar-fill { background: #333; }
}
